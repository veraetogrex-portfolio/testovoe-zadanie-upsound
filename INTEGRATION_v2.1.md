# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è v2.1.0 - P0 Critical Features

## –û–±–∑–æ—Ä

–£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (P0) –∏–∑ –¢–ó v1.1:
- ‚úÖ Fallback-–ø–∞—Ä—Å–∏–Ω–≥ (JSON-LD ‚Üí Open Graph ‚Üí HTML/CSS)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (User-Agent rotation, browser headers, exponential backoff)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä—Ç–∏—Å—Ç–æ–≤ (feat. —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### src/services/request_manager.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- User-Agent rotation (6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)
- –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (Accept, Accept-Language, Sec-Fetch-*)
- Exponential backoff —Å jitter
- HTTP/2 –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- Retry-After header support –¥–ª—è 429 –æ—Ç–≤–µ—Ç–æ–≤

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
RequestManager(
    timeout=REQUEST_TIMEOUT,      # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
    max_retries=3,                 # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫
    initial_delay=1.0,             # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    max_delay=60.0,                # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    multiplier=2.0,                # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è backoff
    jitter=0.1                     # –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å ¬±10%
)
```

#### src/services/cache.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: In-memory –∫—ç—à —Å TTL –¥–ª—è —Ç—Ä–µ–∫–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- TTL-based –∫—ç—à (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (hits, misses, hit_rate)
- –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (get, set, clear, stats, reset_stats)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
TrackCache(
    maxsize=1000,  # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π
    ttl=3600       # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ (—Å–µ–∫—É–Ω–¥—ã)
)
```

#### src/parsers/cascade.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Orchestration –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å fallback

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–∞—Ä—Å–µ—Ä–∞–º–∏
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
- –ú–µ—Ç–æ–¥ can_parse() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤

**–ü–∞—Ä—Å–µ—Ä—ã**:
1. **JsonLdParser** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) - Schema.org JSON-LD
2. **OpenGraphParser** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) - Open Graph meta tags
3. **HtmlCssParser** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3) - CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

#### src/parsers/json_ld.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–∞—Ä—Å–∏–Ω–≥ JSON-LD —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ò–∑–≤–ª–µ–∫–∞–µ—Ç**:
- name (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞)
- byArtist (–∞—Ä—Ç–∏—Å—Ç/–∞—Ä—Ç–∏—Å—Ç—ã)
- duration (ISO 8601 ‚Üí MM:SS)
- inAlbum.name (–∞–ª—å–±–æ–º)

#### src/parsers/open_graph.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Fallback –ø–∞—Ä—Å–µ—Ä –¥–ª—è Open Graph meta tags

**–ò–∑–≤–ª–µ–∫–∞–µ—Ç**:
- og:title (–æ–±—ã—á–Ω–æ "Track - Artist")
- og:audio:artist –∏–ª–∏ music:musician
- music:duration (—Å–µ–∫—É–Ω–¥—ã ‚Üí MM:SS)
- og:album

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–∞—Ä—Å–∏–Ω–≥ og:title —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ (‚Äî, -, ‚Äì)
- Graceful fallback –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è

#### src/parsers/html_css.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback —á–µ—Ä–µ–∑ CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

**–°–µ–ª–µ–∫—Ç–æ—Ä—ã** (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ fallback –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è):
- track_name: `h1.track__title`, `.d-track__title`, `[data-testid="track-title"]`
- artist: `.d-track__artists a`, `.track__artists a`, `.track__subtitle`
- duration: `.d-track__duration`, `.track__duration`, `[data-testid="duration"]`
- album: `.d-album-title`, `.album__title`, `[data-testid="album-title"]`

#### src/utils/artists.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤

**–§–æ—Ä–º–∞—Ç—ã**:
- 1 –∞—Ä—Ç–∏—Å—Ç: `"–ö–∏–Ω–æ"`
- 2 –∞—Ä—Ç–∏—Å—Ç–∞: `"Miyagi feat. –≠–Ω–¥—à–ø–∏–ª—å"`
- 3+ –∞—Ä—Ç–∏—Å—Ç–æ–≤: `"DJ Snake feat. Lil Jon, Pitbull"`

### 2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### src/services/yandex_parser.py
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RequestManager –≤–º–µ—Å—Ç–æ httpx.AsyncClient
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CascadeParser –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ JSON-LD –ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω TrackCache —Å TTL
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ (—É–¥–∞–ª–µ–Ω—ã _extract_json_ld, _extract_track_info –∏ —Ç.–¥.)
- ‚úÖ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã: get_cache_stats(), get_parser_stats(), clear_cache()
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π close() —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞ get_track_info()**:
```python
async def get_track_info(
    self,
    url: str,
    track_id: Optional[str] = None
) -> Optional[TrackInfo]
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã __init__()**:
```python
YandexMusicParser(
    cache_maxsize=1000,    # –†–∞–∑–º–µ—Ä –∫—ç—à–∞
    cache_ttl=3600,        # TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    max_retries=MAX_RETRIES  # Retry –ø–æ–ø—ã—Ç–∫–∏
)
```

#### src/handlers/common.py
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ cache_key: `f"{album_id}:{track_id}"`
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ track_id –≤ parser.get_track_info()

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π –∫–æ–¥**:
```python
# –§–æ—Ä–º–∏—Ä—É–µ–º cache_key –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
cache_key = f"{album_id}:{track_id}"

# –ü–∞—Ä—Å–∏–Ω–≥ —Ç—Ä–µ–∫–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
track_info = await parser.get_track_info(url, track_id=cache_key)
```

#### requirements.txt
**–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
```txt
cachetools==5.3.2  # TTL –∫—ç—à
lxml==5.1.0        # –ë—ã—Å—Ç—Ä—ã–π HTML –ø–∞—Ä—Å–µ—Ä
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ù–æ–≤—ã–π flow –ø–∞—Ä—Å–∏–Ω–≥–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL
2. Handler –∏–∑–≤–ª–µ–∫–∞–µ—Ç album_id, track_id
3. Handler —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç cache_key = "album_id:track_id"
4. Handler –≤—ã–∑—ã–≤–∞–µ—Ç parser.get_track_info(url, track_id=cache_key)

5. YandexMusicParser.get_track_info():
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ (TrackCache.get)
   ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç cached TrackInfo
   ‚îÇ
   ‚îú‚îÄ HTTP-–∑–∞–ø—Ä–æ—Å (RequestManager.fetch):
   ‚îÇ  ‚îú‚îÄ –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ User-Agent
   ‚îÇ  ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
   ‚îÇ  ‚îú‚îÄ Exponential backoff –ø—Ä–∏ retry
   ‚îÇ  ‚îî‚îÄ HTTP/2 –∑–∞–ø—Ä–æ—Å
   ‚îÇ
   ‚îú‚îÄ –ö–∞—Å–∫–∞–¥–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (CascadeParser.parse):
   ‚îÇ  ‚îú‚îÄ –ü–æ–ø—ã—Ç–∫–∞ #1: JsonLdParser
   ‚îÇ  ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí –≤–æ–∑–≤—Ä–∞—Ç TrackInfo
   ‚îÇ  ‚îÇ
   ‚îÇ  ‚îú‚îÄ –ü–æ–ø—ã—Ç–∫–∞ #2: OpenGraphParser
   ‚îÇ  ‚îÇ  ‚îî‚îÄ –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí –≤–æ–∑–≤—Ä–∞—Ç TrackInfo
   ‚îÇ  ‚îÇ
   ‚îÇ  ‚îî‚îÄ –ü–æ–ø—ã—Ç–∫–∞ #3: HtmlCssParser
   ‚îÇ     ‚îî‚îÄ –ï—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí –≤–æ–∑–≤—Ä–∞—Ç TrackInfo
   ‚îÇ
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à (TrackCache.set)

6. Handler —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** | ~200ms | <1ms | 200x –±—ã—Å—Ç—Ä–µ–µ |
| **–ü–∞—Ä—Å–∏–Ω–≥ HTML** | html.parser | lxml | 5-10x –±—ã—Å—Ç—Ä–µ–µ |
| **HTTP-–ø—Ä–æ—Ç–æ–∫–æ–ª** | HTTP/1.1 | HTTP/2 | ~30% –±—ã—Å—Ç—Ä–µ–µ |
| **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | ‚Üë‚Üë‚Üë |
| **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º** | JSON-LD only | 3 fallback | ‚Üë‚Üë‚Üë |

### –ö—ç—à hit rate (–æ–∂–∏–¥–∞–µ–º—ã–π)

–ü—Ä–∏ —Ç–∏–ø–∏—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏):
- **Hit rate**: 40-60%
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –Ø–Ω–¥–µ–∫—Å**: 40-60%
- **–£–ª—É—á—à–µ–Ω–∏–µ UX**: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫
python src/bot.py
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### 1. –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```
URL: https://music.yandex.ru/album/3192570/track/26464125
–û–∂–∏–¥–∞–µ—Ç—Å—è: –£—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ JSON-LD (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
```

#### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å URL –ø–µ—Ä–≤—ã–π —Ä–∞–∑
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ—Ç –∂–µ URL –≤—Ç–æ—Ä–æ–π —Ä–∞–∑
–û–∂–∏–¥–∞–µ—Ç—Å—è:
  - –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: ~200-500ms (HTTP + –ø–∞—Ä—Å–∏–Ω–≥)
  - –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å: <1ms (–∏–∑ –∫—ç—à–∞)
–õ–æ–≥–∏: "‚úÖ –¢—Ä–µ–∫ –Ω–∞–π–¥–µ–Ω –≤ –∫—ç—à–µ: {album_id}:{track_id}"
```

#### 3. User-Agent rotation
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ RequestManager:
–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π User-Agent
```

#### 4. Exponential backoff
```
–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å 502/503 –æ—à–∏–±–∫–∏:
–û–∂–∏–¥–∞–µ—Ç—Å—è: Retry —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–µ–π—Å—è –∑–∞–¥–µ—Ä–∂–∫–æ–π (1s, 2s, 4s...)
```

#### 5. Fallback –ø–∞—Ä—Å–∏–Ω–≥
```
–ï—Å–ª–∏ JSON-LD –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
  - –ü–æ–ø—ã—Ç–∫–∞ Open Graph
  - –ü–æ–ø—ã—Ç–∫–∞ HTML/CSS
–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —É—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–µ—Ä: "‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω —Å –ø–æ–º–æ—â—å—é {parser_name}"
```

#### 6. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç—ã
```
URL —Å 2+ –∞—Ä—Ç–∏—Å—Ç–∞–º–∏
–û–∂–∏–¥–∞–µ—Ç—Å—è: "Artist1 feat. Artist2, Artist3"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```python
# –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /stats

stats = parser.get_cache_stats()
# {
#   'size': 42,
#   'maxsize': 1000,
#   'ttl': 3600,
#   'hits': 156,
#   'misses': 42,
#   'hit_rate': '78.8%'
# }

parser_stats = parser.get_parser_stats()
# {
#   'parsers_count': 3,
#   'parsers': [
#     {'name': 'JSON-LD', 'priority': 1},
#     {'name': 'Open Graph', 'priority': 2},
#     {'name': 'HTML/CSS', 'priority': 3}
#   ]
# }
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–æ–≤—ã–µ –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏—è

```
INFO  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω YandexMusicParser v1.1: cache=1000/3600s, retries=3
INFO  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–∞—Å–∫–∞–¥–Ω—ã–π –ø–∞—Ä—Å–µ—Ä —Å 3 –ø–∞—Ä—Å–µ—Ä–∞–º–∏: JSON-LD, Open Graph, HTML/CSS
INFO  - ‚úÖ –¢—Ä–µ–∫ –Ω–∞–π–¥–µ–Ω –≤ –∫—ç—à–µ: 3192570:26464125
INFO  - ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω —Å –ø–æ–º–æ—â—å—é JSON-LD
INFO  - –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞: size=42/1000, hits=156, misses=42, hit_rate=78.8%

DEBUG - Cache HIT: 3192570:26464125
DEBUG - Cache MISS: 3192570:26464125
DEBUG - üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∫—ç—à: 3192570:26464125
```

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

### P1 Features (Important) - –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

- [ ] **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã URL**: –ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –±–µ–∑ album_id
- [ ] **Following redirects**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
- [ ] **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞**: –ì–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ vs —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ç—Ä–µ–∫
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (—É–∂–µ –±–∞–∑–æ–≤–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ)

### P2 Features (Desirable) - –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

- [ ] **Rate limiting**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ú–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã
- [ ] **Graceful shutdown**: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ shutdown
- [ ] **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ URL**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- [ ] **Health check**: Endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –±–æ—Ç–∞
- [ ] **Alerting**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] –ö–æ–º–∞–Ω–¥–∞ `/stats` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—ç—à–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/clear_cache` –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- [ ] Webhooks –≤–º–µ—Å—Ç–æ polling –¥–ª—è production
- [ ] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- [ ] CI/CD pipeline
- [ ] Unit/Integration —Ç–µ—Å—Ç—ã

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã/–¥–æ–±–∞–≤–ª–µ–Ω—ã

### –î–æ–±–∞–≤–ª–µ–Ω—ã
```
src/parsers/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ base.py             # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ø–∞—Ä—Å–µ—Ä–∞
‚îú‚îÄ‚îÄ json_ld.py          # JSON-LD –ø–∞—Ä—Å–µ—Ä (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
‚îú‚îÄ‚îÄ open_graph.py       # Open Graph –ø–∞—Ä—Å–µ—Ä (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
‚îú‚îÄ‚îÄ html_css.py         # HTML/CSS –ø–∞—Ä—Å–µ—Ä (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
‚îî‚îÄ‚îÄ cascade.py          # Orchestration –∫–∞—Å–∫–∞–¥–∞

src/services/
‚îú‚îÄ‚îÄ request_manager.py  # HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
‚îî‚îÄ‚îÄ cache.py            # TTL –∫—ç—à –¥–ª—è —Ç—Ä–µ–∫–æ–≤

src/utils/
‚îî‚îÄ‚îÄ artists.py          # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–∏—Å—Ç–æ–≤

INTEGRATION_v2.1.md     # –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
```

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
```
src/services/yandex_parser.py   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
src/handlers/common.py          # –ü–µ—Ä–µ–¥–∞—á–∞ track_id –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
requirements.txt                # –î–æ–±–∞–≤–ª–µ–Ω—ã cachetools, lxml
CHANGELOG.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v2.1.0
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python src/bot.py
```

## –†–µ–∑—é–º–µ

‚úÖ **P0 Critical Features** - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–´ –ò –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–´

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –æ–±–ª–∞–¥–∞–µ—Ç:
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–∞ (3 fallback –ø–∞—Ä—Å–µ—Ä–∞)
- –ó–∞—â–∏—Ç–æ–π –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (User-Agent rotation, browser headers, exponential backoff)
- –í—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, HTTP/2, lxml)
- –£–ª—É—á—à–µ–Ω–Ω—ã–º UX (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤)
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤

–ì–æ—Ç–æ–≤ –∫ production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ
